(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[936],{7870:function(e,A,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Next.js/01-Routing/01-07-Loading-UI-and-Streaming",function(){return t(2344)}])},2344:function(e,A,t){"use strict";t.r(A),t.d(A,{__toc:function(){return g},default:function(){return u}});var n=t(5893),s=t(2673),i=t(9298),a=t(9812);t(6834);var r=t(2643),o={src:"/_next/static/media/loading-ui.7ce3b884.avif",height:691,width:1600,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAADAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgIfNECAgaEMg8XwAAASBAAAcYUBPmq7lA=",blurWidth:8,blurHeight:3},l={src:"/_next/static/media/loading-special-file.9225caca.avif",height:606,width:1600,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAADAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACJtZGF0EgAKCBgIfNECAgaEMgwXwAAASAAAAR6f//M=",blurWidth:8,blurHeight:3},d={src:"/_next/static/media/loading-overview.441db421.avif",height:766,width:1600,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAEAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACJtZGF0EgAKCBgIftECAgaEMgwXwAAASAAAavzbEZw=",blurWidth:8,blurHeight:4},c={src:"/_next/static/media/server-rendering-without-streaming-chart.c4d784a3.avif",height:612,width:1600,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAADAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACJtZGF0EgAKCBgIfNECAgaEMgwXwAAASAAAALASmpg=",blurWidth:8,blurHeight:3},h={src:"/_next/static/media/server-rendering-without-streaming.61fc58f1.avif",height:748,width:1600,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB4AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAEAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACZtZGF0EgAKCBgIftECAgaEMhAXwAAASBAAa7EjtibS5E0V",blurWidth:8,blurHeight:4},x={src:"/_next/static/media/server-rendering-with-streaming.87cfe809.avif",height:785,width:1600,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAEAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgIftECAgaEMg8XwAAASBAAAb3LW86DSTQ=",blurWidth:8,blurHeight:4},p={src:"/_next/static/media/server-rendering-with-streaming-chart.6d367744.avif",height:730,width:1600,blurDataURL:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAgAAAAEAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACJtZGF0EgAKCBgIftECAgaEMgwXwAAASAAAALASmpg=",blurWidth:8,blurHeight:4};let g=[{depth:2,value:"Instant Loading States",id:"instant-loading-states"},{depth:2,value:"Streaming with Suspense",id:"streaming-with-suspense"},{depth:3,value:"Streaming คืออะไร",id:"streaming-คืออะไร"},{depth:2,value:"ตัวอย่าง",id:"ตัวอย่าง"},{depth:2,value:"SEO",id:"seo"},{depth:2,value:"Status Code",id:"status-code"},{depth:2,value:"Next Steps",id:"next-steps"}];function _createMdxContent(e){let A=Object.assign({h1:"h1",p:"p",img:"img",h2:"h2",pre:"pre",code:"code",span:"span",blockquote:"blockquote",ul:"ul",li:"li",h3:"h3",strong:"strong",ol:"ol",a:"a"},(0,r.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(A.h1,{children:"01-07 Loading UI and Streaming"}),"\n",(0,n.jsxs)(A.p,{children:["การใช้ไฟล์ loading.js ซึ่งเป็นไฟล์พิเศษเฉพาะช่วยในการแสดง UI เพื่อสื่อความหมายว่าการทำงานของ route segment อยู่ในสถานะกำลังโหลดข้อมูลจาก server เมื่อการโหลดข้อมูลเสร็จสิ้น ก็จะแสดงเนื้อหาที่โหลดมาโดยอัตโนมัติ โดยที่ไฟล์นี้จะมีความสัมพันธ์กับ React Suspense ซึ่งจะกล่าวถึงในอีกหัวข้อหนึ่ง\n",(0,n.jsx)(A.img,{placeholder:"blur",src:o})]}),"\n",(0,n.jsx)(A.h2,{id:"instant-loading-states",children:"Instant Loading States"}),"\n",(0,n.jsx)(A.p,{children:"Instant Loading States คือการเรียกใช้(fallback) UI เพื่อให้แสดงทันทีเมื่อมีการเรียกใช้ navigation เราสามารถทำการ pre-render ตัวแสดงสถานะขณะกำลังโหลด เตรียมไว้ก่อน เช่น การใช้ skeleton แสดง layout คร่าวๆของของข้อมูล หรือการแสดงตัว spinners เพื่อแสดงสถานะว่ากำลังโหลดข้อมูลอยู่ หรือการสื่อความหมายสำหรับหน้าจอที่จะแสดงผลต่อจากนี้ เช่น รูป cover หรือ title เป็นต้น การทำแบบนี้จะช่วยให้ผู้ใช้เข้าใจว่าแอพลิเคชันของเรากำลังทำงานอยู่ จึงทำให้ผู้ใช้เกิดประสบการณ์ที่ดีขึ้น"}),"\n",(0,n.jsxs)(A.p,{children:["เราสามารถสร้าง loading state โดยการสร้างไฟล์ loading.js เพิ่มเข้าไปในโฟลเดอร์ ดังแสดงในภาพข้างล่างนี้\n",(0,n.jsx)(A.img,{placeholder:"blur",src:l})]}),"\n",(0,n.jsx)(A.pre,{"data-language":"tsx","data-theme":"default",filename:"app/dashboard/loading.tsx",children:(0,n.jsxs)(A.code,{"data-line-numbers":"","data-language":"tsx","data-theme":"default","data-line-numbers-max-digits":"1",children:[(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-function)"},children:"Loading"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-comment)"},children:"// เราสามารถใส่ UI แบบต่างๆเข้ามาใน loading รวมถึงสามารถใช้ Skeleton ตรงนี้ได้"})]}),"\n",(0,n.jsx)(A.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" <"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-constant)"},children:"LoadingSkeleton"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" />;"})]}),"\n",(0,n.jsx)(A.span,{className:"line",children:(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsxs)(A.p,{children:["loading.js จะถูกครอบไว้ใน layout.js ที่อยู่ในโฟลเดอร์เดียวกัน และมันจะครอบ page.js และ children ข้างล่างที่อยู่ในขอบเขตของ ",(0,n.jsx)(A.code,{children:"<Suspense>"})," ให้โดยอัตโนมัติ\n",(0,n.jsx)(A.img,{placeholder:"blur",src:d})]}),"\n",(0,n.jsxs)(A.blockquote,{children:["\n",(0,n.jsx)(A.p,{children:"สิ่งที่ควรรู้"}),"\n",(0,n.jsxs)(A.ul,{children:["\n",(0,n.jsx)(A.li,{children:"Navigtion จะทำงานทันทีร่วมกับ server-centric routing"}),"\n",(0,n.jsx)(A.li,{children:"Navigation สามารถถูกขัดจังหวะการทำงานได้ หมายความว่า การเปลี่ยน route สามารถเกิดขึ้นได้ทันทีไม่ต้องรอให้โหลดเสร็จทั้งหมดก่อน ก่อนที่จะเปลี่ยนไป route อื่น"}),"\n",(0,n.jsx)(A.li,{children:"layout ที่ถูกใช้ร่วมกันยังคงทำงานอยู่แม้ว่ากำลังโหลด route segment ใหม่"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(A.blockquote,{children:["\n",(0,n.jsx)(A.p,{children:"คำแนะนำ:\nใน Next.js จะใช้ loading.js ตามข้อกำหนดสำหรับ route segment (route และ pages) ให้เกิดความเหมาะสมมากที่สุด"}),"\n"]}),"\n",(0,n.jsx)("hr",{}),"\n",(0,n.jsx)(A.h2,{id:"streaming-with-suspense",children:"Streaming with Suspense"}),"\n",(0,n.jsx)(A.p,{children:"นอกจาก loading.js แล้วเรายังสามารถสร้าง Suspense Boundaries ขึ้นมาเองได้โดยใช้ UI ของเราเอง ใน App Router รองรับการ streaming ด้วย Suspense ทั้งใน Node.js และใน Edge runtime"}),"\n",(0,n.jsx)(A.h3,{id:"streaming-คืออะไร",children:"Streaming คืออะไร"}),"\n",(0,n.jsxs)(A.p,{children:["ในส่วนนี้เราจะมาเรียนรู้การทำงานของ Streaming ใน React และ Next.js เพื่อช่วยให้เราเข้าใจการทำงานและข้อจำกัดของ ",(0,n.jsx)(A.strong,{children:"Server-Side Rendering(SSR)"})]}),"\n",(0,n.jsx)(A.p,{children:"นี่คือขั้นตอนการทำงานของ SSR ที่ต้องทำให้เสร็จทุกขั้นตอนก่อนที่ผู้ใช้จะสามารถเห็นและใช้งานหน้าเพจนั้นได้"}),"\n",(0,n.jsxs)(A.ol,{children:["\n",(0,n.jsx)(A.li,{children:"ข้อมูลทั้งหมดของหน้านั้นจะต้องถูก fetched บน server"}),"\n",(0,n.jsx)(A.li,{children:"Server ทำการ render ให้เป็น HTML สำหรับหน้านั้น"}),"\n",(0,n.jsx)(A.li,{children:"ทั้ง HTML CSS และ JavaScript ของหน้านั้นจะถูกส่งไปที่ client"}),"\n",(0,n.jsx)(A.li,{children:"ทำการสร้าง HTML และ CSS โดยไม่แสดงส่วนที่เป็น interactive"}),"\n",(0,n.jsx)(A.li,{children:"ขั้นตอนสุดท้าย React hydrates เพื่อสร้าง interface ที่เป็น interactive ของหน้านั้น"}),"\n"]}),"\n",(0,n.jsxs)(A.p,{children:[(0,n.jsx)(A.img,{placeholder:"blur",src:c}),"\nในขั้นตอนนี้จะทำงานเป็นลำดับขั้นและเป็นแบบ blocking หมายความว่า จะ render ข้อมูล HTML ทั้งหมดในครั้งเดียวที่มีการ fetched ข้อมูล และในฝั่ง client React สามารถทำได้แค่การ hydrate UI เมื่อโค้ดทั้งหมดทุก component ในหน้าเพจได้ถูกดาวน์โหลดเสร็จเรียบร้อยแล้ว"]}),"\n",(0,n.jsxs)(A.p,{children:["SSR กับ React และ Next.js จะทำการปรับปรุงประสิทธิภาพในการดาวน์โหลดร่วมกัน โดยแสดงเฉพาะข้อมูลเพจที่ไม่มี interactive ให้เร็วที่สุดเท่าที่เป็นไปได้\n",(0,n.jsx)(A.img,{placeholder:"blur",src:h}),"\nแต่อย่างไรก็ตาม อาจจะยังช้าอยู่ถ้าการ fetch ข้อมูลทั้งหมดที่ต้องการบน server จะต้องเสร็จก่อนที่เพจจะแสดงให้ผู้ใช้ได้เห็น"]}),"\n",(0,n.jsxs)(A.p,{children:[(0,n.jsx)(A.strong,{children:"Streaming"})," ทำให้เราแบ่ง HTML ของหน้าเพจเป็นส่วนเล็กๆ และ server จะทยอยส่งชิ้นส่วนเหล่านี้มาให้ client จนกว่าจะหมด\n",(0,n.jsx)(A.img,{placeholder:"blur",src:x}),"\nการทำแบบนี้จะทำให้หน้าเพจค่อยๆแสดงทีละส่วนจนหมดโดยไม่ต้องรอให้ข้อมูลทั้งหมดถูก render ก่อนที่จะเปลี่ยนไป"]}),"\n",(0,n.jsxs)(A.p,{children:["Streaming ทำงานได้ดีกับแอพในรูปแบบของ React component เพราะสามารถคิดว่าแต่ละ component คือแต่ละส่วนได้ Component ที่มีความสำคัญสูงกว่า เช่น product information หรือ component ที่ไม่ขึ้นอยู่กับข้อมูลเช่น layout จะได้รับการส่งมาก่อน ทำให้ React สามารถเริ่มทำการ hydration ได้เร็วขึ้น ส่วน Component ที่มีความสำคัญต่ำ เช่น review หรือ สินค้าที่เกี่ยวข้อง จะถูกส่งจาก request เดียวกันของ server หลังจากที่ ข้อมูลถูก fetched แล้ว\n",(0,n.jsx)(A.img,{placeholder:"blur",src:p}),"\nการ Streaming นี้เป็นข้อได้เปรียบเมื่อเราต้องการป้องกันการ request ข้อมูลนานๆ จาก blocking page จากการ rendering นั่นคือการลด Time to First Byte(TTFB) และ First Contentful Paint(FCP) นั่นก็หมายความว่า ช่วยให้ Time to Interactive(TTI) ดีขึ้นด้วย โดยเฉพาะกับในอุปกรณ์ที่ทำงานช้า"]}),"\n",(0,n.jsx)(A.h2,{id:"ตัวอย่าง",children:"ตัวอย่าง"}),"\n",(0,n.jsxs)(A.p,{children:[(0,n.jsx)(A.code,{children:"<suspense>"})," จะทำงานโดยการครอบ component ที่ทำงานแบบ asynchronous action เช่น การ fetch ข้อมูล การแสดง fallback UI เช่น skeleton หรือ spinner เมื่อมันเกิดขึ้นและจะเปลี่ยนเป็นหน้าที่เราต้องการทันทีเมื่อการทำงานเสร็จสิ้น"]}),"\n",(0,n.jsx)(A.pre,{"data-language":"tsx","data-theme":"default",filename:"app/dashboard/page.tsx",children:(0,n.jsxs)(A.code,{"data-line-numbers":"","data-language":"tsx","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" { Suspense } "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"react"'}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" { PostFeed"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" Weather } "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"./Components"'}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(A.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-function)"},children:"Posts"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"    <"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:"section"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"      <"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-constant)"},children:"Suspense"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-function)"},children:"fallback"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"{<"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:"p"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">Loading feed...</"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:"p"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">}>"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"        <"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-constant)"},children:"PostFeed"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" />"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"      </"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-constant)"},children:"Suspense"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"      <"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-constant)"},children:"Suspense"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-function)"},children:"fallback"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"{<"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:"p"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">Loading weather...</"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:"p"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">}>"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"        <"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-constant)"},children:"Weather"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:" />"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"      </"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-constant)"},children:"Suspense"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsxs)(A.span,{className:"line",children:[(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"    </"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-token-string-expression)"},children:"section"}),(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,n.jsx)(A.span,{className:"line",children:(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"  );"})}),"\n",(0,n.jsx)(A.span,{className:"line",children:(0,n.jsx)(A.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsxs)(A.p,{children:["ประโยชน์จากการใช้ ",(0,n.jsx)(A.code,{children:"<Suspense>"})," คือ"]}),"\n",(0,n.jsxs)(A.ol,{children:["\n",(0,n.jsx)(A.li,{children:"Streaming Server Rendering - ทำการทยอย Render HTML จาก server ไปให้ client"}),"\n",(0,n.jsx)(A.li,{children:"Selective Hydration - React จะจัดลำดับความสำคัญก่อนหลังให้แต่ละ component ที่จะทำ interactive กับผู้ใช้"}),"\n"]}),"\n",(0,n.jsxs)(A.p,{children:["สำหรับตัวอย่างเพิ่มเติมเกี่ยวกับ ",(0,n.jsx)(A.code,{children:"Suspense"})," และวิธีการใช้งาน ศึกษาได้จาก ",(0,n.jsx)(A.a,{href:"https://react.dev/reference/react/Suspense",children:"React Document"})]}),"\n",(0,n.jsx)(A.h2,{id:"seo",children:"SEO"}),"\n",(0,n.jsxs)(A.ul,{children:["\n",(0,n.jsxs)(A.li,{children:["Next.js จะรอให้ fetching data ข้างใน ",(0,n.jsx)(A.code,{children:"generateMetadata"})," ให้เสร็จก่อนจึงจะทำการ streaming UI ไปให้ client เพื่อเป็นการรับประกันว่า ส่วนแรกที่ได้ทำการ streamed ไปแล้วมี ",(0,n.jsx)(A.code,{children:"<head>"})," tag อยู่ด้วยแน่นอน"]}),"\n",(0,n.jsxs)(A.li,{children:["เมื่อ streaming ถูก server render เสร็จ จะไม่ส่งผลกระทบต่อ SEO เราสามารถใช้เครื่องมือทดสอบชื่อ ",(0,n.jsx)(A.a,{href:"https://search.google.com/test/mobile-friendly",children:"Mobile Friendly Test"})," ของ google เพื่อดูว่า page ของเรามีลำดับการแสดงผลบน Google web crawler อย่างไรบ้าง และดูการเรียงลำดับของ HTML (",(0,n.jsx)(A.a,{href:"https://web.dev/articles/rendering-on-the-web#seo-considerations",children:"source"}),")"]}),"\n"]}),"\n",(0,n.jsx)(A.h2,{id:"status-code",children:"Status Code"}),"\n",(0,n.jsxs)(A.p,{children:["เมื่อเราทำการ streaming สำเร็จ จะมีการคืนค่าเป็นโค้ด ",(0,n.jsx)(A.code,{children:"200"})," เพื่อแสดงว่า server ทำสิ่งที่ request มาสำเร็จ"]}),"\n",(0,n.jsxs)(A.p,{children:["และ Server ยังสามารถคืนค่า error หรือ issue ที่เกิดขึ้นไปให้ client พร้อมกับข้อมูลที่ stream ไปให้ client ด้วย ตัวอย่าง เช่น การใช้ ",(0,n.jsx)(A.code,{children:"redirect"})," หรือ ",(0,n.jsx)(A.code,{children:"notFound"})," เมื่อส่งส่วนของ headers ไปให้ client เสร็จเรียบร้อยแล้ว status code นี้จะไม่มีการ update อีก การทำแบบนี้จะไม่มีผลกระทบต่อ SEO"]}),"\n",(0,n.jsx)("hr",{}),"\n",(0,n.jsx)(A.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,n.jsxs)(A.p,{children:["ต่อไปเราจะไปเรียนรู้เกี่ยวกับ ",(0,n.jsx)(A.a,{href:"https://themodcoding.vercel.app/blogs/01-08-Error-Handling",children:"Error Handling"})," กัน"]}),"\n",(0,n.jsx)("hr",{}),"\n",(0,n.jsx)(A.p,{children:"แปลและเรียบเรียงโดย ModTdin"}),"\n",(0,n.jsxs)(A.p,{children:["Original: ",(0,n.jsx)(A.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming",children:"Loading UI and Streaming"})]}),"\n",(0,n.jsx)("hr",{}),"\n",(0,n.jsx)(A.p,{children:(0,n.jsx)(A.a,{href:"https://themodcoding.vercel.app/blogs/01-06-Dynamic-Routes",children:"01-06-Dynamic-Routes"})}),"\n",(0,n.jsx)(A.p,{children:(0,n.jsx)(A.a,{href:"/",children:(0,n.jsx)(A.strong,{children:"Home"})})})]})}let j={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:A}=Object.assign({},(0,r.a)(),e.components);return A?(0,n.jsx)(A,{...e,children:(0,n.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/Next.js/01-Routing/01-07-Loading-UI-and-Streaming.mdx",route:"/Next.js/01-Routing/01-07-Loading-UI-and-Streaming",frontMatter:{title:"01-07 Loading UI and Streaming",description:"การใช้ Loading UI และ Streaming ใน App Router ของ Next.js"},timestamp:1705286637e3,pageMap:[{kind:"Folder",name:"Expressjs",route:"/Expressjs",children:[{kind:"Meta",data:{express:{title:"Express Home"},"--------":{type:"separator"},"getting-started":{title:"การสร้าง server ด้วย Express.js"},"express-application":"Express Application"}},{kind:"MdxPage",name:"express-application",route:"/Expressjs/express-application",frontMatter:{title:"Express Application",description:"Express Application"}},{kind:"MdxPage",name:"express",route:"/Expressjs/express"},{kind:"MdxPage",name:"getting-started",route:"/Expressjs/getting-started",frontMatter:{title:"การสร้าง server ด้วย Express.js",description:"การสร้างแอปพลิเคชั่นด้วย Express.js"}}]},{kind:"Folder",name:"Next.js",route:"/Next.js",children:[{kind:"MdxPage",name:"00-00-getting-started",route:"/Next.js/00-00-getting-started",frontMatter:{title:"00-00 Next.js Getting Started",description:"เริ่มต้นกับ Next.js"}},{kind:"MdxPage",name:"00-01-Installation",route:"/Next.js/00-01-Installation",frontMatter:{title:"00-01 การติดตั้ง Next.js (Installation)",description:"การติดตั้ง Next.js"}},{kind:"MdxPage",name:"00-02-Project-Structure",route:"/Next.js/00-02-Project-Structure",frontMatter:{title:"00-02 โครงสร้างไฟล์และโฟลเดอร์ใน Next.js (Next.js Project Structure)",description:"การติดตั้ง Next.js"}},{kind:"Folder",name:"01-Routing",route:"/Next.js/01-Routing",children:[{kind:"MdxPage",name:"01-00-App-Router",route:"/Next.js/01-Routing/01-00-App-Router",frontMatter:{title:"01-00 App Router",description:"บทนำเข้าสู่ App Router"}},{kind:"MdxPage",name:"01-01-Routing-Fundamentals",route:"/Next.js/01-Routing/01-01-Routing-Fundamentals",frontMatter:{title:"01-01 Routing Fundamentals",description:"ความรู้พื้นฐานเกี่ยวกับ Routing"}},{kind:"MdxPage",name:"01-02-Defining-Routes",route:"/Next.js/01-Routing/01-02-Defining-Routes",frontMatter:{title:"01-02 Defining Routes",description:"การกำหนด Route"}},{kind:"MdxPage",name:"01-03-Pages-and-Layouts",route:"/Next.js/01-Routing/01-03-Pages-and-Layouts",frontMatter:{title:"01-03 การสร้าง Pages และ Layouts",description:"การสร้าง Pages และ Layouts ด้วย TypeScript"}},{kind:"MdxPage",name:"01-04-Linking-and-Navigating",route:"/Next.js/01-Routing/01-04-Linking-and-Navigating",frontMatter:{title:"01-04 Linking and Navigating",description:"การสร้าง Link และ Navigation ใน Next.js"}},{kind:"MdxPage",name:"01-05-Route-Groups",route:"/Next.js/01-Routing/01-05-Route-Groups",frontMatter:{title:"01-05 การจัดกลุ่มของ Routes (Route Groups)",description:"การจัดกลุ่มของ Routes ใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-06-Dynamic-Routes",route:"/Next.js/01-Routing/01-06-Dynamic-Routes",frontMatter:{title:"01-06 Dynamic Routes",description:"การจัดการ Dynamic Routes ใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-07-Loading-UI-and-Streaming",route:"/Next.js/01-Routing/01-07-Loading-UI-and-Streaming",frontMatter:{title:"01-07 Loading UI and Streaming",description:"การใช้ Loading UI และ Streaming ใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-08-Error-Handling",route:"/Next.js/01-Routing/01-08-Error-Handling",frontMatter:{title:"01-08 Error Handling",description:"การจัดการกับ Error ใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-09-Parallel-Routes",route:"/Next.js/01-Routing/01-09-Parallel-Routes",frontMatter:{title:"01-09 Parallel Routes",description:"การทำงานแบบ Parallel Routes ใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-10-Intercepting-Routes",route:"/Next.js/01-Routing/01-10-Intercepting-Routes",frontMatter:{title:"01-10 Intercepting Routes",description:"การทำงานแบบ Intercepting Routes ใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-11-Route-Handlers",route:"/Next.js/01-Routing/01-11-Route-Handlers",frontMatter:{title:"01-11 Route Handlers",description:"การจัดการ Routes (Route Handlers) ใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-12-Middleware",route:"/Next.js/01-Routing/01-12-Middleware",frontMatter:{title:"01-12 Middleware",description:"การใช้ Middleware เพื่อ run code ก่อนที่ request จะทำงานเสร็จใน App Router ของ Next.js"}},{kind:"MdxPage",name:"01-13-colocation",route:"/Next.js/01-Routing/01-13-colocation",frontMatter:{title:"01-13 Project Organization and File Colocation",description:"Learn how to organize your Next.js project and colocate files."}},{kind:"MdxPage",name:"01-14-internationallization",route:"/Next.js/01-Routing/01-14-internationallization",frontMatter:{title:"01-14 Internationalization",description:"Add support for multiple languages with internationalized routing and localized content."}},{kind:"Meta",data:{"01-00-App-Router":"01-00 App Router","01-01-Routing-Fundamentals":"01-01 Routing Fundamentals","01-02-Defining-Routes":"01-02 Defining Routes","01-03-Pages-and-Layouts":"01-03 การสร้าง Pages และ Layouts","01-04-Linking-and-Navigating":"01-04 Linking and Navigating","01-05-Route-Groups":"01-05 การจัดกลุ่มของ Routes (Route Groups)","01-06-Dynamic-Routes":"01-06 Dynamic Routes","01-07-Loading-UI-and-Streaming":"01-07 Loading UI and Streaming","01-08-Error-Handling":"01-08 Error Handling","01-09-Parallel-Routes":"01-09 Parallel Routes","01-10-Intercepting-Routes":"01-10 Intercepting Routes","01-11-Route-Handlers":"01-11 Route Handlers","01-12-Middleware":"01-12 Middleware","01-13-colocation":"01-13 Project Organization and File Colocation","01-14-internationallization":"01-14 Internationalization"}}]},{kind:"Folder",name:"02-data-fetching",route:"/Next.js/02-data-fetching",children:[{kind:"MdxPage",name:"02-01-fetching-caching-and-revalidating",route:"/Next.js/02-data-fetching/02-01-fetching-caching-and-revalidating",frontMatter:{title:"Data Fetching, Caching, and Revalidating",description:"Learn how to fetch, cache, and revalidate data in your Next.js application."}},{kind:"MdxPage",name:"02-02-server-actions-and-mutations",route:"/Next.js/02-data-fetching/02-02-server-actions-and-mutations",frontMatter:{title:"Server Actions and Mutations",description:"Learn how to handle form submissions and data mutations with Next.js."}},{kind:"MdxPage",name:"02-03-patterns",route:"/Next.js/02-data-fetching/02-03-patterns",frontMatter:{title:"Patterns and Best Practices",description:"Learn about common data fetching patterns in React and Next.js."}},{kind:"MdxPage",name:"index",route:"/Next.js/02-data-fetching",frontMatter:{title:"Data Fetching",description:"Learn how to fetch, cache, revalidate, and mutate data with Next.js."}},{kind:"Meta",data:{index:"Data Fetching","02-01-fetching-caching-and-revalidating":"Data Fetching, Caching, and Revalidating","02-03-patterns":"Patterns and Best Practices","02-02-server-actions-and-mutations":"Server Actions and Mutations"}}]},{kind:"Meta",data:{home:{title:"back to TheModCoding",type:"page",href:"https://themodcoding.vercel.app",newWindow:!0},"00-00-getting-started":"00-00 Next.js Getting Started","00-01-Installation":"00-01 การติดตั้ง Next.js (Installation)","00-02-Project-Structure":"00-02 โครงสร้างไฟล์และโฟลเดอร์ใน Next.js (Next.js Project Structure)"}}]},{kind:"Meta",data:{index:{title:"Home",type:"page"},"Next.js":{title:"Next.js",type:"page"},Expressjs:{title:"Express.js",type:"page"},themodcoding:{title:"TheModCoding",type:"page",href:"https://themodcoding.vercel.app",newWindow:!0}}},{kind:"MdxPage",name:"index",route:"/"}],flexsearch:{codeblocks:!0},title:"01-07 Loading UI and Streaming",headings:g},pageNextRoute:"/Next.js/01-Routing/01-07-Loading-UI-and-Streaming",nextraLayout:i.ZP,themeConfig:a.Z};var u=(0,s.j)(j)},9812:function(e,A,t){"use strict";var n=t(5893);t(7294);let s={logo:(0,n.jsx)("span",{children:"document.ModTdin"}),project:{link:"https://github.com/Tuengdin/themoddocu"},docsRepositoryBase:"https://github.com/shuding/nextra-docs-template",footer:{text:"document.ModTdin.com"}};A.Z=s}},function(e){e.O(0,[774,361,888,179],function(){return e(e.s=7870)}),_N_E=e.O()}]);